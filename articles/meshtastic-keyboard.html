
<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://so1der.github.io/theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
    href="https://so1der.github.io/theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark), (prefers-color-scheme: no-preference)"
          href="https://so1der.github.io/theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light)"
          href="https://so1der.github.io/theme/pygments/github.min.css">



  <link rel="stylesheet" type="text/css" href="https://so1der.github.io/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://so1der.github.io/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://so1der.github.io/theme/font-awesome/css/solid.css">

  <link rel="stylesheet" type="text/css" href="/static/custom.css">




  <link href="https://so1der.github.io/rss.xml" type="application/rss+xml" rel="alternate" title="so1der RSS">







 

<meta name="author" content="so1der" />
<meta name="description" content="Підключаємо стару USB клавіатуру до вузла Meshtastic!" />
<meta name="keywords" content="diy, meshtastic, зв&#39;язок">


  <meta property="og:site_name" content="so1der"/>
  <meta property="og:title" content="Клавіатура для вузла Meshtastic!"/>
  <meta property="og:description" content="Підключаємо стару USB клавіатуру до вузла Meshtastic!"/>
  <meta property="og:locale" content="uk"/>
  <meta property="og:url" content="https://so1der.github.io/articles/meshtastic-keyboard.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2024-12-07 17:01:00+02:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="https://so1der.github.io/author/so1der.html">
  <meta property="article:section" content="YouTube"/>
  <meta property="article:tag" content="diy"/>
  <meta property="article:tag" content="meshtastic"/>
  <meta property="article:tag" content="зв&#39;язок"/>
  <meta property="og:image" content="/logo.png">

  <title>so1der &ndash; Клавіатура для вузла Meshtastic!</title>


</head>
<body >

<aside>
  <div>
    <a href="https://so1der.github.io/">
      <img src="/logo.png" alt="so1der" title="so1der">
    </a>

    <h1>
      <a href="https://so1der.github.io/">so1der</a>
    </h1>

    <p>Вітаю Вас на моєму особистому сайті!</p>


    <nav>
      <ul class="list">



          <li>
            <a target="_self" href="/articles/about.html#about" >Про мене</a>
          </li>
          <li>
            <a target="_self" href="/articles/website.html#website" >Про вебсайт</a>
          </li>
          <li>
            <a target="_self" href="/articles/contact.html#contact" >зв'язок</a>
          </li>
      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-github"
           href="https://github.com/so1der"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
      <li>
        <a class="sc-youtube"
           href="https://www.youtube.com/@CtrlD-3v3"
           target="_blank">
          <i class="fa-brands fa-youtube"></i>
        </a>
      </li>
      <li>
        <a class="sc-mastodon"
rel="me"           href="https://soc.ua-fediland.de/@noaa_in_ukraine/"
           target="_blank">
          <i class="fa-brands fa-mastodon"></i>
        </a>
      </li>
      <li>
        <a class="sc-rss"
           href="/rss.xml"
           target="_blank">
          <i class="fa-solid fa-rss"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="https://so1der.github.io/">Головна</a>

  <a href="/archives.html">Архіви</a>
  <a href="/categories.html">Категорії</a>
  <a href="/tags.html">Теги</a>


  <a href="https://so1der.github.io/rss.xml">RSS</a>
</nav>

<article class="single">
  <header>
      
    <h1 id="meshtastic-keyboard">Клавіатура для вузла Meshtastic!</h1>
    <p>
      Опубліковано 07.12.2024, 17:01 в категорії <a href="https://so1der.github.io/category/youtube.html">YouTube</a>

    </p>
  </header>


  <div>
    <p><img alt="&quot;Вузли&quot;" src="https://so1der.github.io/images/meshtastic-keyboard/nodes.jpg" title="Вузли"></p>
<p>З моменту створення мого першого вузла Meshtastic пройшло вже немало часу. За цей час я більш детально розібрався в цій темі, і навіть зібрав другий вузол, і зробив їм круті корпуси, з повноцінними антенами з рацій. Але ця стаття буде трошки про інше.</p>
<p>Існує безліч варіацій вузлів, і деякі з них мають клавіатуру, що робить з них цілком самодостатній пристрій - можна відправляти повідомлення навіть не підключаючи телефон.</p>
<p>Наразі є 3 основні клавіатури які Meshtastic підтримує без модифікації прошивки. Це клавіатура від телефонів BlackBerry в пристроях T-deck, клавіатура пристрою Chatter типу "Text on 9 keys", або ж T9, тобто клавіатура типу тих які були в старих телефонах ну і I2C клавіатура від M5Stack яка називається CardKB. CardKB це найдоступніше рішення, так як її можна легко придбати приблизно за 10 доларів на AliExpress. </p>
<p><img alt="&quot;CardKB&quot;" src="https://so1der.github.io/images/meshtastic-keyboard/cardkb.png" title="CardKB"></p>
<p>Але мені не хотілось витрачати на це гроші, тим паче я хотів просто поекспериментувати з клавіатурою, а не додавати її до свої вузлів. </p>
<p>Тому я продовжив вивчати інформацію, і в решті решт прийшов до висновку, що до Meshtastic цілком можливо підключити стару дротову USB клавіатуру! Забігаючи наперед, мені вдалось це зробити, хоч і з певними нюансами, тому давайте про все по порядку.</p>
<p>Перш за все, потрібна саме стара мембранна USB клавіатура. Бездротові, хоч вони і можуть мати так званий USB Донгл, який працює на частотх 2.4 ГГц - не підходять. Так само і не підходять механічні клавіатури, наскільки мені відомо (але можу помилятись).</p>
<p>Це на перший погляд дивне обмеження насправді зумовлено тим, що мембранні клавіатури можуть працювати як за стандартом USB, так і за стандартом <a href="https://uk.wikipedia.org/wiki/PS/2_(%D0%BF%D0%BE%D1%80%D1%82)">PS/2</a>. Якщо хост, тобто пристрій до якого підключено клавіатуру, не відповідає їй певним USB пакетом, то клавіатура починає працювати як PS/2 пристрій. Це зроблено для того, щоб ці клавіатури без проблем можна було використовувати на старих комп'ютерах, через пасивні перехідники. Тобто перехідники які не мають в собі ніяких мікросхем, конвертерів, і тд, вони просто перетворюють один штекер в інший.</p>
<p>І ось на відміну від складного USB, цей PS/2 набагато простіший, і тому звичайні мікроконтролери які не мають підтримки USB теж можуть працювати з такими клавіатурами. </p>
<p><img alt="&quot;Часова діаграма протоколу PS/2&quot;" src="https://so1der.github.io/images/meshtastic-keyboard/ps2-waveform.jpg" title="Часова діаграма протоколу PS/2"></p>
<p>Можливо можна було б взяти якийсь крутий девборд <strong>STM32</strong>, і використати його, адже більшість мікроконтролерів STM32 мають вбудовану підтримку USB, але це вже складніше, тому для початку я вирішив спробувати хоча б використати клавіатуру в режимі PS/2. В цьому мені допомогла раніше згадана клавіатура CardKB. Справа в тому, що якщо ми не хочемо модифікувати прошивку Meshtastic, то треба імітувати одну з вже підтримуваних клавіатур, і CardKB для цього найкращий варіант, бо там стоїть ATmega8A, вихідний код якої <a href="https://github.com/m5stack/M5-ProductExampleCodes/blob/master/Unit/CARDKB/firmware_328p/CardKeyBoard/CardKeyBoard.ino">знаходиться в вільному доступі</a>.</p>
<p>Тому можна легко його проаналізувати, і взяти звідти потрібні частини, щоб написати свою прошивку, яка буде відправляти дані так само як й CardKB. Також мені допомогла ще <a href="https://www.hackster.io/michalin70/connect-a-usb-keyboard-with-an-arduino-50c077">ось ця стаття</a>, де розповідається про підключення клавіатури до Arduino. Тобто як бачите, сам я майже нічого не писав, а лише об'єднав 2 вже готових проєкти.</p>
<p>По ітогу вийшов <a href="https://github.com/so1der/mesh_usb_keyboard/blob/main/USB_Keyboard/src/main.cpp">ось такий ось код</a>, який треба залити до якоїсь Ардуінки. Я писав код в PlatformIO, тобто проєкт можна відкрити і компілювати в ньому, але якщо ви хочете це можна зробити і в ArduinoIDE, але тоді доведеться трішки посунути місцями функції, бо у PlatformIO відмінний від ArduinoIDE порядок декларування функцій. А може і ні))00</p>
<p>Окрім самої клавіатури та Ардуіно, нам знадобиться ще конвертер логічних рівнів, пара резисторів на 10 кОм, та USB роз'єм. Конвертер рівнів потрібен так як клавіатура та Ардуіно працюють від 5V, а наявний в Meshtastic девборд ESP32 та OLED екран працюють від 3.3V, тому якщо подати на них 5V, є шанс пошкодити їх.</p>
<p>Треба з'єднати все за схемою - об'єднати всі землі, під'єднати <code>Data +</code> до 7-го піну а <code>Data -</code> до 6-го піну мікроконтролеру, а також підтягнути їх до +5V резисторами на 10 кОм.</p>
<p>(так, я знаю наскільки погано це виглядає, уж звиняйте)</p>
<p><img alt="&quot;Схема&quot;" src="https://so1der.github.io/images/meshtastic-keyboard/schematic.png" title="Схема"></p>
<p>Контакти I2C, тобто SDA та SCL зі сторони Ардуіно треба підключити до високої сторони конвертера рівнів. Також до високої сторони підключено напругу 5V, а до низької підключено 3.3V. Контакти I2С зі сторони Meshtastic треба під'єднати до відповідних контактів низької сторони конвертеру рівнів. Їх до речі можна взяти прямо з дисплею, я саме так і зробив - для тестів підійде. </p>
<p>Після цього я зібрав все на макетній платі. </p>
<p><img alt="&quot;Зібрана схема&quot;" src="https://so1der.github.io/images/meshtastic-keyboard/assembled.jpg" title="Зібрана схема"></p>
<p>Тепер треба зайти в налаштування вузлу з телефону, знайти пункт <code>Canned Messages</code>, включити його, і в полі вводу <strong>"Allow input source"</strong> ввести <code>cardkb</code>. Пристрій перезавантажиться, і буде готовий приймати команди по шині I2C.</p>
<p><img alt="&quot;Налаштування&quot;" src="https://so1der.github.io/images/meshtastic-keyboard/settings.jpg" title="Налаштування"></p>
<p>На диво, все запрацювало з першого разу! Таким чином з вузла можна зробити цілком самодостатній пристрій, який зможе відправляти повідомлення в основний канал без необхідності підключатись з телефону. </p>
<p><img alt="&quot;Повідомлення, відправлене за допомогою клавіатури&quot;" src="https://so1der.github.io/images/meshtastic-keyboard/message.jpg" title="Повідомлення, відправлене за допомогою клавіатури"></p>
<p>Звісно наявність додаткового мікроконтролеру та конвертеру рівнів все трішки ускладнює в плані збірки, фінансової вартості проєкту, а також в плані автономності - бо як мінімум було додано ще один мікроконтролер.</p>
<p>Більш того, є ціла купа технічних обмежень - Не можна змінити розкладку, не можна використовувати Shift або Caps Lock, і тд.Ну і найбільша проблема - дуже низька швидкість друкування. Думаю тут проблема в самій прошивці Meshtastick, адже по Serial порту все працює швидко. Мабуть ESP32 просто не встигає одночасно керувати  дисплеєм з клавіатурою, адже вони висять на одній шині, і одночасно з цим треба ще й радіомодулем керувати, обробляти купу інформації, і тд, тому маємо що маємо.</p>
<p>Але все це було зроблено у якості експерименту, і так званого Proof Of Concept. Я написав про це на форум Meshtastic, і можливо це допоможе розробникам проєкту реалізувати щось подібне на базі основного мікроконтролеру Meshtastic-а, і можна буде як мінімум позбутись додаткового мікроконтролеру.</p>
<p>Який ж висновок можна зробити з цього всього?</p>
<p>По перше - старі мембранні клавіатури можна легко використовувати у якості пристрою вводу в ваших проєктах на мікроконтролерах.</p>
<p>По друге - проєкт Meshtastic не перестає дивувати своїм функціоналом та можливостями. Мені дуже подобається цей проєкт, тому я з задоволенням читаю changelogs нових версій прошивки, та час від часу прошиваю свої вузли.</p>
<p>Ну і по третє - якби не ініціатива OpenSource, цього всього не було б. І Meshtastic-а, і цього міні проєкту, і навіть моїх відео на каналі, бо я свої відео створю на повністю вільному програмному забезпечені.</p>
<p>Так що якось так. Підтримуйте ініціативу OpenSource!</p>
<h2>Post Scriptum</h2>
<p>Це текстова версія відео з мого YouTube каналу. Відео можна переглянути <a href="https://www.youtube.com/watch?v=OJUR7Bi8m7w">за посиланням</a></p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://so1der.github.io/tag/diy.html">diy</a>
      <a href="https://so1der.github.io/tag/meshtastic.html">meshtastic</a>
      <a href="https://so1der.github.io/tag/zviazok.html">зв'язок</a>
    </p>
  </div>







</article>

<footer>
<p>&copy; 2025 </p>
<p>
Сайт створено за допомогою <a href="http://getpelican.com" target="_blank">Pelican</a> використовуючи <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> тему
  <span class="footer-separator">|</span>
  Обрати <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> тему
  <script id="dark-theme-script"
          src="https://so1der.github.io/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="dark"
          type="text/javascript">
  </script>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " so1der ",
  "url" : "https://so1der.github.io",
  "image": "/logo.png",
  "description": ""
}
</script>
</body>
</html>